#!/usr/bin/env python3

import os
import argparse


def get_db_path():
    zsh_share_path = os.path.expanduser("~/.local/share/zsh")
    os.makedirs(zsh_share_path, exist_ok=True)
    db_path = os.path.join(zsh_share_path, "cwd_history")
    return db_path


def read_db():
    db_path = get_db_path()
    if os.path.exists(db_path):
        with open(db_path, "r") as fp:
            return [x.strip() for x in fp.readlines()]
    else:
        return list()


def write_db(paths):
    db_path = get_db_path()
    with open(db_path, "w") as fp:
        fp.writelines((x + "\n" for x in paths))


def add_to_db(path):
    paths = read_db()
    if path not in paths:
        paths.append(path)
        write_db(paths)


def remove_from_db(path):
    paths = read_db()
    if path in paths:
        paths.remove(path)
        write_db(paths)


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument("action", choices=["add", "remove"])
    parser.add_argument("path")

    args = parser.parse_args()
    path = args.path

    if args.action == "add":
        add_to_db(path)
    else:
        remove_from_db(path)


if __name__ == "__main__":
    main()
